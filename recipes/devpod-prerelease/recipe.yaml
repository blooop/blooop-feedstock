schema_version: 1

package:
  name: devpod-prerelease
  version: "0.7.0_alpha.36"

source:
  # NOTE: Using skevetter's fork of devpod from https://github.com/skevetter/devpod/releases
  # This package tracks PRE-RELEASE versions (prerelease: true in GitHub)
  # For stable releases, use the 'devpod' package instead
  - url: https://github.com/skevetter/devpod/releases/download/v0.7.0-alpha.36/devpod-linux-amd64  # [linux and x86_64]
    sha256: 5b31e2fc70fdcc4ed2f851fbfcb9cb4d6ef7572b08a5b91c424a06f0ea003202  # [linux and x86_64]
  - url: https://github.com/skevetter/devpod/releases/download/v0.7.0-alpha.36/devpod-linux-arm64  # [linux and aarch64]
    sha256: 54cc2b8971be146767f165d78b47a947083e6d61f6ba60a0a42fa145aac9e53e  # [linux and aarch64]
  - url: https://github.com/skevetter/devpod/releases/download/v0.7.0-alpha.36/devpod-darwin-amd64  # [osx and x86_64]
    sha256: 88edff03d65de59063d9bf250dc5eb78df69e4ac9f59049e07770db7e3f10de7  # [osx and x86_64]
  - url: https://github.com/skevetter/devpod/releases/download/v0.7.0-alpha.36/devpod-darwin-arm64  # [osx and arm64]
    sha256: 94f19e1fe45fc56dd9070a209a7ddea4941ed5708e18b8cf73fadeeb0e811e53  # [osx and arm64]
  - url: https://github.com/skevetter/devpod/releases/download/v0.7.0-alpha.36/devpod-windows-amd64.exe  # [win]
    sha256: abd3bfd4d8acec0b1b154e2781eead6d042f5c82d732d72a81aa499968270edd  # [win]

build:
  number: 0
  script:
    - if: unix
      then:
        - mkdir -p "$PREFIX/bin"
        - |
          case "${target_platform:-}" in
            linux-64)      SRC_FILE="devpod-linux-amd64" ;;
            linux-aarch64) SRC_FILE="devpod-linux-arm64" ;;
            osx-64)        SRC_FILE="devpod-darwin-amd64" ;;
            osx-arm64)     SRC_FILE="devpod-darwin-arm64" ;;
            *) echo "Unsupported target_platform: ${target_platform:-unknown}" && exit 1 ;;
          esac
          cp "$SRC_DIR/$SRC_FILE" "$PREFIX/bin/devpod"
          chmod 755 "$PREFIX/bin/devpod"
    - if: win
      then:
        - if not exist %PREFIX%\Library\bin mkdir %PREFIX%\Library\bin
        - copy %SRC_DIR%\devpod-windows-amd64.exe %PREFIX%\Library\bin\devpod.exe

tests:
  - script:
      - if: unix
        then:
          - which devpod
          - test -x $PREFIX/bin/devpod
          - |
              if "$PREFIX/bin/devpod" version; then
                :
              else
                status=$?
                if [ "$status" -eq 126 ]; then
                  echo "Skipping runtime test for non-native binary on $(uname -m)"
                else
                  exit "$status"
                fi
              fi
      - if: win
        then:
          - where devpod
          - devpod version

about:
  homepage: https://devpod.sh
  license: MPL-2.0
  license_family: MOZILLA
  summary: DevPod pre-release - Codespaces but open-source, client-only and unopinionated
  description: |
    **PRE-RELEASE VERSION** - This package tracks pre-release versions of DevPod.
    For stable releases, install the 'devpod' package instead.

    DevPod is an open-source tool that allows you to create reproducible developer
    environments based on a devcontainer.json on any backend. Each developer environment
    runs in a separate container and is specified through a devcontainer.json.

    DevPod can use any IDE and works with any cloud provider, Kubernetes cluster,
    or on localhost. It's designed to be a cost-effective alternative to GitHub
    Codespaces and similar hosted services.

    Key features:
    - Support for multiple IDEs (VSCode, JetBrains, and more)
    - Works with various backends (Docker, Kubernetes, SSH, cloud VMs)
    - DevContainer standard compliant
    - Client-only architecture for maximum privacy and control
  documentation: https://devpod.sh/docs
  repository: https://github.com/skevetter/devpod

extra:
  recipe-maintainers:
    - blooop
