[workspace]
name = "blooop-feedstock"
description = "Feedstock for blooop conda channel"
authors = ["blooop <your-email@example.com>"]
channels = ["https://prefix.dev/blooop", "conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "linux-aarch64"]

[dependencies]
rattler-build = "*"
python = ">=3.10"
curl = "*"

[tasks]
# Build specific packages
build-shim = "rattler-build build --recipe recipes/claude-shim/recipe.yaml --output-dir output"
build-shim-linux = "rattler-build build --recipe recipes/claude-shim/recipe.yaml --target-platform linux-64 --output-dir output"
build-shim-macos = "rattler-build build --recipe recipes/claude-shim/recipe.yaml --target-platform osx-64 --output-dir output"
build-shim-windows = "rattler-build build --recipe recipes/claude-shim/recipe.yaml --target-platform win-64 --output-dir output"

build-ralph = "rattler-build build --recipe recipes/ralph-claude-code/recipe.yaml --output-dir output"

# Build iterfzf
build-iterfzf = "rattler-build build --recipe recipes/iterfzf/recipe.yaml --output-dir output"

# Build devpod-prerelease
build-devpod-prerelease = "rattler-build build --recipe recipes/devpod-prerelease/recipe.yaml --output-dir output"

# Build speedtest-go
build-speedtest-go = "rattler-build build --recipe recipes/speedtest-go/recipe.yaml --output-dir output"

# Build ROS Jazzy packages
build-pymoveit2 = "rattler-build build --recipe recipes/ros-jazzy-pymoveit2/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-ros2-joystick-gui = "rattler-build build --recipe recipes/ros-jazzy-ros2-joystick-gui/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-zbar-ros-interfaces = "rattler-build build --recipe recipes/ros-jazzy-zbar-ros-interfaces/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-zbar-ros = "rattler-build build --recipe recipes/ros-jazzy-zbar-ros/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-robot-calibration-msgs = "rattler-build build --recipe recipes/ros-jazzy-robot-calibration-msgs/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-robot-calibration = "rattler-build build --recipe recipes/ros-jazzy-robot-calibration/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"

# Build ROS Jazzy hardware packages
build-phantom-touch-msgs = "rattler-build build --recipe recipes/ros-jazzy-phantom-touch-msgs/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-phantom-touch-description = "rattler-build build --recipe recipes/ros-jazzy-phantom-touch-description/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-phantom-touch-control = "rattler-build build --recipe recipes/ros-jazzy-phantom-touch-control/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-zed-components = "rattler-build build --recipe recipes/ros-jazzy-zed-components/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-zed-wrapper = "rattler-build build --recipe recipes/ros-jazzy-zed-wrapper/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"
build-zed-ros2 = "rattler-build build --recipe recipes/ros-jazzy-zed-ros2/recipe.yaml --output-dir output -c https://prefix.dev/robostack-jazzy -c conda-forge -c https://prefix.dev/blooop"

# Build all packages
build-all = { depends-on = ["build-shim", "build-ralph", "build-devpod-prerelease", "build-iterfzf", "build-speedtest-go"] }

# Check for updates across all packages
check-updates = "bash scripts/check-updates.sh"

# Test local builds
test-shim = "rattler-build test --recipe recipes/claude-shim/recipe.yaml"

# Docker-based installation tests
test-docker = "bash scripts/run-docker-tests.sh"

# Clean build outputs
clean = "rm -rf output/*"

# Development tasks
lint-recipes = '''
    for recipe in recipes/*/recipe.yaml; do
        echo "Checking $recipe..."
        python -c "import yaml; yaml.safe_load(open('$recipe'))"
    done
'''

[feature.dev.dependencies]
pre-commit = "*"
black = "*"
flake8 = "*"

[environments]
default = { solve-group = "default" }
dev = { features = ["dev"], solve-group = "default" }
